# 로그인/회원가입 코드 문제점 분석

## 🔴 심각한 보안 문제

### 1. 비밀번호 평문 저장 및 비교
**위치:** `backend/server.js`
- **회원가입 (378줄):** 비밀번호를 평문으로 저장
  ```javascript
  password, // TODO: bcrypt로 해시화 필요
  ```
- **로그인 (327줄):** 비밀번호를 평문으로 비교
  ```javascript
  if (user.password !== password) {
  ```
- **위험성:** 데이터베이스가 유출되면 모든 사용자의 비밀번호가 노출됨
- **해결 방법:** bcrypt 또는 argon2를 사용하여 해시화

### 2. 토큰이 단순 문자열
**위치:** `backend/server.js`
- **로그인 (336줄):** `token: \`token-${user._id}\``
- **회원가입 (392줄):** `token: \`token-${newUser._id}\``
- **위험성:** 
  - 토큰 위조가 쉬움
  - 만료 시간 없음
  - 서명 검증 없음
- **해결 방법:** JWT 토큰 사용 (jsonwebtoken 패키지)

### 3. 인증 없이 첫 번째 사용자 사용
**위치:** `backend/server.js`
- **프로필 조회 (413줄):** `userId`가 없으면 첫 번째 사용자 사용
  ```javascript
  if (userId) {
    user = await User.findById(userId);
  } else {
    user = await User.findOne(); // ⚠️ 보안 문제
  }
  ```
- **위험성:** 인증 없이 다른 사용자의 정보에 접근 가능
- **해결 방법:** JWT 토큰에서 userId 추출, 없으면 401 반환

## 🟡 로직 문제

### 4. 회원가입 코드 중복 및 불필요한 else 블록
**위치:** `app/signup.tsx`
- **69줄:** `if (USE_BACKEND_API)` 체크 후
- **99줄:** `else` 블록이 있지만 실행되지 않음 (이미 64줄에서 USE_BACKEND_API가 false면 return)
- **문제:** 불필요한 코드, 혼란스러운 로직
- **해결 방법:** else 블록 제거 또는 로직 재구성

### 5. 프로필 업데이트 에러 메시지 부족
**위치:** `contexts/AuthContext.tsx`
- **116줄:** `updateProfile()` 함수가 boolean만 반환
- **문제:** 실패 이유를 알 수 없음
- **해결 방법:** 에러 메시지도 함께 반환

## 🟠 입력값 검증 부족

### 6. 비밀번호 검증이 최소 길이만 체크
**위치:** `app/login.tsx`, `app/signup.tsx`
- **현재:** `password.length < 6`만 체크
- **부족한 검증:**
  - 최대 길이 제한 없음
  - 특수문자, 숫자, 대소문자 조합 요구 없음
  - 일반적인 약한 비밀번호 체크 없음
- **해결 방법:** 더 강력한 비밀번호 정책 적용

### 7. 이메일 검증이 기본 형식만 체크
**위치:** `app/login.tsx`, `app/signup.tsx`
- **현재:** 기본 정규식만 사용
- **부족한 검증:**
  - 도메인 유효성 검증 없음
  - 이메일 길이 제한 없음
- **해결 방법:** 더 엄격한 이메일 검증

## 🔵 개선 권장 사항

### 8. 에러 로깅 개선
- 민감한 정보(비밀번호)가 로그에 남지 않도록 주의
- 구조화된 에러 로깅

### 9. Rate Limiting 부재
- 로그인/회원가입 시도 횟수 제한 없음
- 브루트포스 공격에 취약
- **해결 방법:** express-rate-limit 사용

### 10. CORS 설정 확인
- 현재 `app.use(cors())`로 모든 도메인 허용
- 프로덕션에서는 특정 도메인만 허용해야 함

### 11. MongoDB 인젝션 방지
- 현재는 Mongoose를 사용하여 자동으로 방지되지만, 명시적으로 확인 필요

## 우선순위별 수정 권장사항

### 🔴 즉시 수정 필요 (보안)
1. 비밀번호 해시화 (bcrypt)
2. JWT 토큰 구현
3. 인증 없이 사용자 정보 접근 방지

### 🟡 빠른 시일 내 수정 권장
4. 회원가입 코드 정리
5. 프로필 업데이트 에러 메시지 개선
6. Rate Limiting 추가

### 🟠 점진적 개선
7. 비밀번호 정책 강화
8. 이메일 검증 개선
9. 에러 로깅 개선
10. CORS 설정 강화

